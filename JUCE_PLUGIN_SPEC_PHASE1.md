# ğŸ¸ JUCE Plugin Specification - Phase 1 (WebView MVP)

## ğŸ“‹ Overview

This document provides complete specifications for creating a JUCE VST3/AU plugin that wraps the Sairyne React UI in a WebView component.

**Goal:** Create a working plugin that displays the existing React app inside Ableton Live, Logic Pro, and other DAWs.

**Phase:** MVP - WebView Integration (no native UI yet)

---

## ğŸ¯ What This Plugin Does

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DAW (Ableton Live / Logic Pro)           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Sairyne Plugin Window               â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  juce::WebBrowserComponent    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â†“                             â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  React UI                      â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - AI Chat (left panel)        â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - Visual Tips (right panel)   â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âœ… Plugin Capabilities

### What It DOES:
- âœ… Appears in DAW plugin list as "Sairyne"
- âœ… Opens as a plugin window (like any VST/AU)
- âœ… Displays React UI via embedded browser
- âœ… AI chat works through backend API
- âœ… Visual Tips display correctly
- âœ… Resizable window (800x600 default)

### What It DOESN'T Do (Phase 1):
- âŒ No audio processing (plugin is UI-only)
- âŒ No FFT analysis yet (Phase 2)
- âŒ No DAW parameter automation
- âŒ No MIDI input/output
- âŒ No native JUCE UI components (all via WebView)

---

## ğŸ› ï¸ Technical Requirements

### JUCE Version
- **Required:** JUCE 8.x (latest stable)
- **Download:** https://juce.com/get-juce/download

### Plugin Formats
- âœ… VST3 (cross-platform)
- âœ… AU (macOS only - for Logic Pro)
- âš ï¸ Skip VST2 (deprecated)
- âš ï¸ Skip AAX (requires iLok, can add later)

### Supported Platforms
- âœ… macOS (Intel + Apple Silicon)
- âœ… Windows (x64)

### Build Tools
- **macOS:** Xcode 14+ (free from App Store)
- **Windows:** Visual Studio 2022 Community (free)
- **CMake:** 3.22+ (optional, JUCE Projucer generates projects)

---

## ğŸ“‚ Project Structure

```
Sairyne_Plugin/
â”œâ”€â”€ Source/
â”‚   â”œâ”€â”€ PluginProcessor.h          # Audio processor (empty for MVP)
â”‚   â”œâ”€â”€ PluginProcessor.cpp
â”‚   â”œâ”€â”€ PluginEditor.h             # UI editor with WebView
â”‚   â”œâ”€â”€ PluginEditor.cpp
â”‚   â””â”€â”€ JuceBridge.h               # JS â†” C++ bridge (Phase 2)
â”œâ”€â”€ JuceLibraryCode/               # Auto-generated by Projucer
â”œâ”€â”€ Builds/
â”‚   â”œâ”€â”€ MacOSX/                    # Xcode project
â”‚   â””â”€â”€ VisualStudio2022/          # VS project
â”œâ”€â”€ Sairyne.jucer                  # JUCE project file
â””â”€â”€ README.md
```

---

## ğŸš€ Step-by-Step Implementation

### Step 1: Create JUCE Project

**Using Projucer:**

1. Open JUCE Projucer
2. Create New Project â†’ Plugin â†’ Basic
3. **Project Settings:**
   - Project Name: `Sairyne`
   - Company Name: `Sairyne`
   - Bundle Identifier: `com.sairyne.plugin`
   - Plugin Code: `Sryn`
   - Plugin Manufacturer Code: `Sary`

4. **Plugin Characteristics:**
   - Plugin is a Synth: âŒ NO
   - Plugin MIDI Input: âŒ NO
   - Plugin MIDI Output: âŒ NO
   - MIDI Effect Plugin: âŒ NO
   - Plugin Editor Requires Keyboard: âœ… YES (for chat input)

5. **Plugin Formats:**
   - Build VST3: âœ… YES
   - Build AU: âœ… YES (macOS only)
   - Build VST: âŒ NO (deprecated)
   - Build AAX: âŒ NO (for now)

6. **Modules:**
   - juce_audio_basics âœ…
   - juce_audio_devices âœ…
   - juce_audio_formats âœ…
   - juce_audio_plugin_client âœ…
   - juce_audio_processors âœ…
   - juce_audio_utils âœ…
   - juce_core âœ…
   - juce_data_structures âœ…
   - juce_events âœ…
   - juce_graphics âœ…
   - juce_gui_basics âœ…
   - juce_gui_extra âœ… **IMPORTANT - for WebBrowserComponent**

7. Save Project â†’ Generate Xcode/VS projects

---

### Step 2: Implement PluginProcessor (Audio Processor)

**File:** `Source/PluginProcessor.h`

```cpp
#pragma once
#include <JuceHeader.h>

class SairyneAudioProcessor : public juce::AudioProcessor
{
public:
    SairyneAudioProcessor();
    ~SairyneAudioProcessor() override;

    void prepareToPlay (double sampleRate, int samplesPerBlock) override;
    void releaseResources() override;
    void processBlock (juce::AudioBuffer<float>&, juce::MidiBuffer&) override;

    juce::AudioProcessorEditor* createEditor() override;
    bool hasEditor() const override { return true; }

    const juce::String getName() const override { return "Sairyne"; }
    
    // No audio processing needed for MVP
    bool acceptsMidi() const override { return false; }
    bool producesMidi() const override { return false; }
    bool isMidiEffect() const override { return false; }
    double getTailLengthSeconds() const override { return 0.0; }

    int getNumPrograms() override { return 1; }
    int getCurrentProgram() override { return 0; }
    void setCurrentProgram (int) override {}
    const juce::String getProgramName (int) override { return {}; }
    void changeProgramName (int, const juce::String&) override {}

    void getStateInformation (juce::MemoryBlock& destData) override;
    void setStateInformation (const void* data, int sizeInBytes) override;

private:
    JUCE_DECLARE_NON_COPYABLE_WITH_LEAK_DETECTOR (SairyneAudioProcessor)
};
```

**File:** `Source/PluginProcessor.cpp`

```cpp
#include "PluginProcessor.h"
#include "PluginEditor.h"

SairyneAudioProcessor::SairyneAudioProcessor()
    : AudioProcessor (BusesProperties()
                      .withInput  ("Input",  juce::AudioChannelSet::stereo(), true)
                      .withOutput ("Output", juce::AudioChannelSet::stereo(), true))
{
}

SairyneAudioProcessor::~SairyneAudioProcessor()
{
}

void SairyneAudioProcessor::prepareToPlay (double, int)
{
    // No audio processing needed for Phase 1
}

void SairyneAudioProcessor::releaseResources()
{
}

void SairyneAudioProcessor::processBlock (juce::AudioBuffer<float>& buffer, juce::MidiBuffer&)
{
    // Pass-through audio (no processing)
    juce::ScopedNoDenormals noDenormals;
    
    for (auto i = getTotalNumInputChannels(); i < getTotalNumOutputChannels(); ++i)
        buffer.clear (i, 0, buffer.getNumSamples());
}

juce::AudioProcessorEditor* SairyneAudioProcessor::createEditor()
{
    return new SairyneAudioProcessorEditor (*this);
}

void SairyneAudioProcessor::getStateInformation (juce::MemoryBlock& destData)
{
    // Save plugin state (empty for now)
}

void SairyneAudioProcessor::setStateInformation (const void* data, int sizeInBytes)
{
    // Restore plugin state (empty for now)
}

// This creates the plugin instance
juce::AudioProcessor* JUCE_CALLTYPE createPluginFilter()
{
    return new SairyneAudioProcessor();
}
```

---

### Step 3: Implement PluginEditor (WebView UI)

**File:** `Source/PluginEditor.h`

```cpp
#pragma once
#include <JuceHeader.h>
#include "PluginProcessor.h"

class SairyneAudioProcessorEditor : public juce::AudioProcessorEditor
{
public:
    explicit SairyneAudioProcessorEditor (SairyneAudioProcessor&);
    ~SairyneAudioProcessorEditor() override;

    void paint (juce::Graphics&) override;
    void resized() override;

private:
    SairyneAudioProcessor& processorRef;
    juce::WebBrowserComponent webView;
    
    // Configuration
    static constexpr int defaultWidth = 800;
    static constexpr int defaultHeight = 600;
    
    JUCE_DECLARE_NON_COPYABLE_WITH_LEAK_DETECTOR (SairyneAudioProcessorEditor)
};
```

**File:** `Source/PluginEditor.cpp`

```cpp
#include "PluginEditor.h"

SairyneAudioProcessorEditor::SairyneAudioProcessorEditor (SairyneAudioProcessor& p)
    : AudioProcessorEditor (&p), processorRef (p)
{
    // Set window size
    setSize (defaultWidth, defaultHeight);
    setResizable (true, true);
    
    // Configure WebView
    addAndMakeVisible (webView);
    
    // IMPORTANT: Choose URL based on environment
    
    // OPTION 1: Development (local Vite server)
    // webView.goToURL ("http://localhost:5173");
    
    // OPTION 2: Production (deployed frontend)
    webView.goToURL ("https://sairyne.vercel.app");
    
    // OPTION 3: Embedded (bundle HTML locally - Phase 2)
    // auto htmlFile = juce::File::getSpecialLocation (juce::File::currentExecutableFile)
    //                     .getParentDirectory()
    //                     .getChildFile ("Resources/index.html");
    // webView.goToURL (htmlFile.getFullPathName());
}

SairyneAudioProcessorEditor::~SairyneAudioProcessorEditor()
{
}

void SairyneAudioProcessorEditor::paint (juce::Graphics& g)
{
    // Background (only visible while WebView loads)
    g.fillAll (juce::Colour (0xff1a1a1a));
}

void SairyneAudioProcessorEditor::resized()
{
    // WebView takes full window
    webView.setBounds (getLocalBounds());
}
```

---

## ğŸ”§ Configuration Options

### URL Configuration

**Development:**
```cpp
webView.goToURL ("http://localhost:5173");
```
- Use when testing locally
- React dev server must be running: `npm run dev`

**Production:**
```cpp
webView.goToURL ("https://sairyne.vercel.app");
```
- Use for distributed plugin
- Requires internet connection

**Embedded (Future):**
```cpp
// Bundle HTML/JS/CSS in plugin binary
auto htmlFile = getResourcesFolder().getChildFile ("index.html");
webView.goToURL (htmlFile.getFullPathName());
```
- Offline mode
- Larger plugin file size
- Requires build step to copy React build

---

## ğŸ—ï¸ Building the Plugin

### macOS (Xcode)

```bash
# 1. Open Projucer project
open Sairyne.jucer

# 2. In Projucer: File â†’ Save Project
# This generates Xcode project in Builds/MacOSX/

# 3. Open Xcode project
open Builds/MacOSX/Sairyne.xcodeproj

# 4. Select scheme: "Sairyne - AU" or "Sairyne - VST3"

# 5. Build (Cmd+B)

# 6. Built plugins will be in:
# ~/Library/Audio/Plug-Ins/Components/Sairyne.component (AU)
# ~/Library/Audio/Plug-Ins/VST3/Sairyne.vst3 (VST3)
```

### Windows (Visual Studio)

```bash
# 1. Open Projucer project
Sairyne.jucer

# 2. In Projucer: File â†’ Save Project
# This generates VS solution in Builds/VisualStudio2022/

# 3. Open VS solution
Builds\VisualStudio2022\Sairyne.sln

# 4. Select configuration: Release, x64

# 5. Build â†’ Build Solution (F7)

# 6. Built plugins will be in:
# C:\Program Files\Common Files\VST3\Sairyne.vst3
```

---

## ğŸ§ª Testing the Plugin

### Test in Ableton Live

1. **Scan for new plugins:**
   - Preferences â†’ Plug-Ins â†’ Rescan

2. **Add plugin to track:**
   - Create MIDI or Audio track
   - Drag "Sairyne" from Plug-Ins browser

3. **Verify:**
   - âœ… Plugin window opens
   - âœ… React UI loads
   - âœ… Chat interface visible
   - âœ… Can type in input field
   - âœ… Visual Tips button works

### Test in Logic Pro (macOS)

1. **Scan for new plugins:**
   - Logic Pro â†’ Preferences â†’ Plug-In Manager â†’ Reset & Rescan

2. **Add plugin:**
   - Mixer â†’ Audio FX â†’ Sairyne

3. **Verify same checklist as above**

---

## ğŸ› Troubleshooting

### Issue: WebView shows blank page

**Solution:**
```cpp
// Add error logging
webView.pageLoadHadNetworkError = [](const juce::String& error)
{
    DBG ("WebView error: " + error);
};

// Check URL is accessible in browser first
```

### Issue: Plugin doesn't appear in DAW

**Solution:**
- Check plugin was built for correct format (VST3/AU)
- Verify plugin is in correct folder (see build paths above)
- Rescan plugins in DAW
- Check Console.app (macOS) or Event Viewer (Windows) for errors

### Issue: Keyboard input doesn't work in chat

**Solution:**
```cpp
// In PluginEditor constructor, add:
setWantsKeyboardFocus (true);
webView.setWantsKeyboardFocus (true);

// In Projucer settings, ensure:
// "Plugin Editor Requires Keyboard" is checked
```

### Issue: WebView crashes on load

**Solution:**
- Ensure `juce_gui_extra` module is enabled in Projucer
- Check URL is valid and accessible
- Try simpler URL first: `webView.goToURL ("https://google.com")`

---

## ğŸ“Š Phase 1 Checklist

### Development
- [ ] JUCE project created in Projucer
- [ ] PluginProcessor implemented (pass-through audio)
- [ ] PluginEditor with WebView implemented
- [ ] URL configured (dev or prod)
- [ ] Project builds without errors

### Testing
- [ ] Plugin loads in Ableton Live
- [ ] Plugin loads in Logic Pro (macOS)
- [ ] WebView displays React UI correctly
- [ ] Chat input works (keyboard focus)
- [ ] AI chat sends messages (requires backend)
- [ ] Visual Tips display correctly
- [ ] Window is resizable

### Deployment
- [ ] macOS build (Intel + Apple Silicon)
- [ ] Windows build (x64)
- [ ] Installer created (optional for MVP)
- [ ] Code signed (optional for MVP)

---

## ğŸš€ Phase 2 Preview (Future)

After MVP is validated, add:

### FFT Audio Engine Integration
```cpp
// In PluginProcessor.cpp
void SairyneAudioProcessor::processBlock (juce::AudioBuffer<float>& buffer, juce::MidiBuffer&)
{
    // FFT analysis
    fftAnalyzer.analyze (buffer);
    
    // Send to WebView via JS bridge
    auto fftData = fftAnalyzer.getFrequencyData();
    sendToWebView ("fftData", fftData);
}
```

### JS â†” C++ Bridge
```cpp
// Send data to WebView
webView.evaluateJavascript (
    "window.receiveFFTData(" + jsonData + ")"
);

// Receive data from WebView
webView.pageLoadFinished = []()
{
    // Inject bridge functions
    webView.evaluateJavascript (R"(
        window.sendToJUCE = function(data) {
            // Bridge implementation
        };
    )");
};
```

### Native JUCE UI (Phase 3)
- Replace WebView with JUCE Components
- Custom LookAndFeel for styling
- Direct integration with audio engine

---

## ğŸ“š Resources

### JUCE Documentation
- **Main Docs:** https://docs.juce.com/
- **WebBrowserComponent:** https://docs.juce.com/master/classWebBrowserComponent.html
- **AudioProcessor:** https://docs.juce.com/master/classAudioProcessor.html
- **Tutorial:** https://docs.juce.com/master/tutorial_create_projucer_basic_plugin.html

### JUCE Forum
- https://forum.juce.com/
- Search for "WebBrowserComponent plugin" for examples

### Example Projects
- JUCE Demo Plugin (in JUCE installation)
- `examples/Plugins/` in JUCE folder

---

## ğŸ“ Support

### For Audio Engineer:
- **Current Frontend:** https://sairyne.vercel.app
- **Local dev:** `npm run dev` â†’ http://localhost:5173
- **Backend API:** (not deployed yet - Full-Stack dev will do)

### For Questions:
- JUCE Forum: https://forum.juce.com/
- JUCE Discord: https://discord.gg/juce
- KVR Audio Forum: https://www.kvraudio.com/forum/

---

## âœ… Summary for Audio Engineer

**What you need to do:**
1. âœ… Install JUCE 8
2. âœ… Create plugin project in Projucer (settings above)
3. âœ… Copy PluginProcessor code (pass-through audio)
4. âœ… Copy PluginEditor code (WebView setup)
5. âœ… Set URL to `https://sairyne.vercel.app`
6. âœ… Build for macOS/Windows
7. âœ… Test in Ableton/Logic

**Time estimate:** 2-3 days for experienced JUCE developer

**FFT Audio Engine:** Add in Phase 2 after WebView plugin is validated

---

**Version:** 1.0.0  
**Last Updated:** October 30, 2025  
**Status:** Ready for Implementation âœ…

