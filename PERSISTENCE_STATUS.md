# üìä Data Persistence - Current Status

## ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **Frontend localStorage** - –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—Ç–∞–µ—Ç
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ email/password —á–µ—Ä–µ–∑ `auth.ts`
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–æ–≤ —á–µ—Ä–µ–∑ `projects.ts`
   - –†–∞–±–æ—Ç–∞–µ—Ç –≤ –±—Ä–∞—É–∑–µ—Ä–µ –∏ standalone –≤–µ—Ä—Å–∏–∏

2. **JUCE PropertiesFile** - –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≥–æ—Ç–æ–≤–∞
   - `PropertiesFile` —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤ `PluginProcessor.cpp`
   - –ü—É—Ç—å: `~/Library/Application Support/Sairyne.settings`
   - –ú–µ—Ç–æ–¥—ã `getPropertiesFile()`, `setValue()`, `save()` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã

3. **JS ‚Üí JUCE Bridge** - —á–∞—Å—Ç–∏—á–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç
   - `juce://save` –∏ `juce://load` —Å—Ö–µ–º—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –≤ C++
   - `postMessage` —Å–∏—Å—Ç–µ–º–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
   - `juceReady` —Ñ–ª–∞–≥ –∏ `pendingSave` –æ—á–µ—Ä–µ–¥—å –¥–æ–±–∞–≤–ª–µ–Ω—ã

## ‚ö†Ô∏è –ß—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ JUCE WebView**
   - `persistUsers()` –∏ `persistProjects()` –≤—ã–∑—ã–≤–∞—é—Ç—Å—è, –Ω–æ –¥–∞–Ω–Ω—ã–µ –Ω–µ –¥–æ—Ö–æ–¥—è—Ç –¥–æ C++
   - –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:
     - `postMessage` –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è WebView sandbox
     - Wrapper script –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç iframe
     - Timing issues (bridge –Ω–µ –≥–æ—Ç–æ–≤ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ)

2. **–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø–ª–∞–≥–∏–Ω–∞**
   - `injectSavedData()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è, –Ω–æ `sairyne_users` –∏ `sairyne_projects` –Ω–µ –Ω–∞–π–¥–µ–Ω—ã
   - –¢–æ–ª—å–∫–æ `sairyne_access_token` –∏ `sairyne_selected_project` —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è

## üîß –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### Frontend (storage.ts)
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `localStorage` –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π –∏—Å—Ç–æ—á–Ω–∏–∫
- –ü—ã—Ç–∞–µ—Ç—Å—è —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ JUCE —á–µ—Ä–µ–∑ `window.saveToJuce()`
- –ï—Å–ª–∏ JUCE –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å `localStorage`

### JUCE Bridge (juceBridge.ts)
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `postMessage` –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö
- –û—á–µ—Ä–µ–¥—å `pendingSave` –¥–ª—è —Ä–∞–Ω–Ω–∏—Ö —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–π
- –§–ª–∞–≥ `juceReady` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ bridge

### C++ (PluginProcessor.cpp)
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç `juce://save` –∏ `juce://load` URL —Å—Ö–µ–º—ã
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ `PropertiesFile`
- –ò–Ω–∂–µ–∫—Ç–∏—Ç –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ `injectSavedData()` –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ

## üìù –î–ª—è –Ω–∞—Ç–∏–≤–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–∞ JUCE

–ö–æ–≥–¥–∞ –ø—Ä–æ–µ–∫—Ç –±—É–¥–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞—Ç–∏–≤–Ω—ã–º –Ω–∞ JUCE, –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç:

1. **–£–±—Ä–∞—Ç—å WebView –ø–æ–ª–Ω–æ—Å—Ç—å—é**
   - –í–µ—Å—å UI –±—É–¥–µ—Ç –Ω–∞ JUCE Components
   - –ù–µ—Ç –ø—Ä–æ–±–ª–µ–º —Å iframe/postMessage

2. **–ü—Ä—è–º–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ PropertiesFile**
   ```cpp
   // –í –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö –≤–≤–æ–¥–∞ (email, password, project name)
   auto* props = audioProcessor->getPropertiesFile();
   props->setValue("sairyne_users", usersJson);
   props->save();
   ```

3. **–ü—Ä—è–º–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ**
   ```cpp
   // –í –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ –∏–ª–∏ init()
   auto* props = audioProcessor->getPropertiesFile();
   auto usersJson = props->getValue("sairyne_users", "");
   // –ü–∞—Ä—Å–∏–º –∏ –∑–∞–≥—Ä—É–∂–∞–µ–º –≤ UI
   ```

4. **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–∞—Ç–∏–≤–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏**
   - ‚úÖ –ù–µ—Ç –ø—Ä–æ–±–ª–µ–º —Å WebView sandbox
   - ‚úÖ –ù–µ—Ç –ø—Ä–æ–±–ª–µ–º —Å postMessage
   - ‚úÖ –ù–µ—Ç –ø—Ä–æ–±–ª–µ–º —Å timing
   - ‚úÖ –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ
   - ‚úÖ –ù–∞–¥–µ–∂–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è

**–û—Å—Ç–∞–≤–∏—Ç—å —Ç–µ–∫—É—â—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –∫–∞–∫ –µ—Å—Ç—å:**
- Frontend —Ä–∞–±–æ—Ç–∞–µ—Ç —Å `localStorage`
- JUCE –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≥–æ—Ç–æ–≤–∞, –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∞–∫—Ç–∏–≤–Ω–æ
- –ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ –Ω–∞—Ç–∏–≤–Ω—ã–π JUCE UI - —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞–ø—Ä—è–º—É—é

**–ù–µ —Ç—Ä–∞—Ç–∏—Ç—å –≤—Ä–µ–º—è –Ω–∞ –æ—Ç–ª–∞–¥–∫—É WebView ‚Üí JUCE bridge:**
- –°–ª–∏—à–∫–æ–º —Å–ª–æ–∂–Ω–∞—è —Ü–µ–ø–æ—á–∫–∞ (JS ‚Üí iframe ‚Üí wrapper ‚Üí C++)
- –ú–Ω–æ–≥–æ —Ç–æ—á–µ–∫ –æ—Ç–∫–∞–∑–∞ (sandbox, postMessage, timing)
- –ü—Ä–∏ –Ω–∞—Ç–∏–≤–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –≤—Å–µ –±—É–¥–µ—Ç –ø—Ä–æ—â–µ –∏ –Ω–∞–¥–µ–∂–Ω–µ–µ

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ Frontend —Ä–∞–±–æ—Ç–∞–µ—Ç, JUCE –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≥–æ—Ç–æ–≤–∞, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ WebView –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç (–æ–∂–∏–¥–∞–µ–º–æ)

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ –Ω–∞—Ç–∏–≤–Ω—ã–π JUCE UI - —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä—è–º–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ PropertiesFile

