# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ localStorage –≤ JUCE WebView (v2)

## üî¥ –ü—Ä–æ–±–ª–µ–º–∞

`withStorageAccess()` –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –≤–µ—Ä—Å–∏–∏ JUCE, –∫–æ—Ç–æ—Ä—É—é –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ.

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

–£–±—Ä–∞–ª `withStorageAccess()` - localStorage –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ WebView.

### –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:

1. **–£–±—Ä–∞–ª –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –º–µ—Ç–æ–¥:**
   - –£–¥–∞–ª–µ–Ω `.withStorageAccess(true)`
   - –£–¥–∞–ª–µ–Ω `.withJavaScriptEnabled(true)` (JavaScript –≤–∫–ª—é—á–µ–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)

2. **–û—Å—Ç–∞–≤–∏–ª —Ç–µ—Å—Ç localStorage:**
   - Helper script –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å localStorage
   - –õ–æ–≥–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –∫–æ–Ω—Å–æ–ª—å

3. **PropertiesFile –≥–æ—Ç–æ–≤ –¥–ª—è fallback:**
   - –ï—Å–ª–∏ localStorage –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å PropertiesFile —á–µ—Ä–µ–∑ JUCE bridge

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ localStorage

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –ø–ª–∞–≥–∏–Ω–∞ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –∏–ª–∏ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–∞):

**–ï—Å–ª–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
```
[Helper] localStorage is available and working
```

**–ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
```
[Helper] localStorage test failed - data not persisted
[Helper] localStorage is not available: ...
```

---

## üîß –ï—Å–ª–∏ localStorage –≤—Å–µ –µ—â–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

–ï—Å–ª–∏ localStorage –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ, –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **JUCE bridge + PropertiesFile**:

### –í–∞—Ä–∏–∞–Ω—Ç: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ JUCE bridge

1. **Frontend –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ:**
   ```typescript
   juceBridge.sendMessage({
     type: 'SAVE_DATA',
     payload: {
       key: 'sairyne_users',
       value: JSON.stringify(users)
     }
   });
   ```

2. **JUCE –ø–æ–ª—É—á–∞–µ—Ç –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç:**
   ```cpp
   if (messageType == "save_data") {
     auto key = json["payload"]["key"].toString();
     auto value = json["payload"]["value"].toString();
     getPropertiesFile()->setValue(key, value);
     getPropertiesFile()->saveIfNeeded();
   }
   ```

3. **–ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ JUCE –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ–±—Ä–∞—Ç–Ω–æ:**
   ```cpp
   // –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ WebView
   auto users = getPropertiesFile()->getValue("sairyne_users", "[]");
   // –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ WebView —á–µ—Ä–µ–∑ JavaScript
   ```

---

## üìù –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

- ‚úÖ –£–±—Ä–∞–Ω –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π `withStorageAccess()`
- ‚úÖ localStorage –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ç–µ—Å—Ç localStorage –≤ helper script
- ‚úÖ PropertiesFile –≥–æ—Ç–æ–≤ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (–µ—Å–ª–∏ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è)

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ JUCE –ø—Ä–æ–µ–∫—Ç** (–æ—à–∏–±–∫–∞ –¥–æ–ª–∂–Ω–∞ –∏—Å—á–µ–∑–Ω—É—Ç—å)
2. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö:**
   - –í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É
   - –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ–µ–∫—Ç
   - –ó–∞–∫—Ä–æ–π—Ç–µ –∏ –æ—Ç–∫—Ä–æ–π—Ç–µ –ø–ª–∞–≥–∏–Ω
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –æ—Å—Ç–∞–ª–∏—Å—å –ª–∏ –¥–∞–Ω–Ω—ã–µ

3. **–ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –æ localStorage
   - –ï—Å–ª–∏ localStorage –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ JUCE bridge + PropertiesFile

---

**–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–∞—á–∞–ª–∞ - localStorage –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é. –ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç - —Å–æ–æ–±—â–∏—Ç–µ, –∏ —è –¥–æ–±–∞–≤–ª—é —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ JUCE bridge! üöÄ**

